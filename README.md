# Zombie-X

## 项目介绍

一款开放世界沙盒末日生存游戏，3D版本的僵尸生存体验。

## 技术栈

- **引擎**: Godot 4.5
- **地形**: Terrain3D 插件
- **语言**: GDScript

## 项目结构

```
zombie-x/
├── addons/              # 插件目录
│   └── terrain_3d/      # Terrain3D 地形插件
├── assets/              # 资源文件
│   └── building/        # 建筑模型
├── camera/              # 相机相关
├── data/                # 数据文件（地形等）
├── effects_shared/      # 共享特效
├── player/              # 玩家系统
│   ├── audio/           # 音效
│   ├── bullet/          # 子弹系统
│   ├── model/           # 玩家模型
│   ├── progress/        # 进度条UI
│   ├── scripts/         # 玩家脚本
│   └── textures/        # 玩家纹理
├── scenes/              # 场景文件
│   ├── main/            # 主场景
│   ├── ui/              # UI场景
│   └── world/           # 世界场景
└── scripts/             # 核心脚本
    ├── constants.gd     # 常量配置（自动加载）
    ├── event_bus.gd     # 事件总线（自动加载）
    └── game_manager.gd  # 游戏管理器（自动加载）
```

## 核心功能

### ✅ 已实现功能

#### 1. 玩家系统
- 第一人称/第三人称视角切换
- 玩家移动（WASD）
- 跳跃系统（含落地检测）
- 相机控制（鼠标/键盘双模式自动切换）
- 瞄准系统（右键瞄准）
- 射击系统（左键射击）
- 换弹系统（R键，含进度条）
- 玩家动画系统（行走、跳跃、瞄准等）
- 根运动系统
- 相机震动效果
- 坠落重生机制

#### 2. 属性系统
- 生命值管理（恢复、受伤、死亡）
- 弹药管理（消耗、补充、换弹）
- 经验和等级系统
- 无敌状态
- 完整的信号系统（属性变化、升级、死亡等）

#### 3. 武器系统
- 枪械射击
- 子弹物理飞行
- 碰撞检测
- 射击特效（粒子、火光）
- 射击冷却机制

#### 4. UI系统
- 动态准星（移动、射击、换弹扩散）
- 圆形进度条组件
- 玩家属性UI控制器
  - 健康条
  - 弹药条
  - 经验条
  - 等级显示
  - 状态显示（正常/无敌/死亡）
- 背包UI（框架）

#### 5. 相机系统
- 鼠标控制模式
- 键盘控制模式（Q/E旋转）
- 相机距离和高度平滑调整（鼠标滚轮）
- 相机X轴旋转限制
- 自动模式切换（根据距离）
- 相机震动支持

#### 6. 核心架构
- **常量配置系统** (`constants.gd`)
  - 集中管理所有游戏常量
  - 包含玩家、相机、子弹、UI等参数
  - 工具函数：`ease_out_cubic()`
  
- **事件总线** (`event_bus.gd`)
  - 信号解耦系统
  - 支持玩家、武器、UI、世界、游戏状态事件
  - 自动加载单例

- **游戏管理器** (`game_manager.gd`)
  - 游戏状态管理（菜单、游戏中、暂停、游戏结束）
  - 玩家注册和管理
  - 暂停/恢复功能
  - 自动加载单例

#### 7. 世界系统
- Terrain3D 地形系统
- 建筑模型（街区）
- 地面碰撞
- 程序化天空

### 📋 开发计划

#### 高优先级
- [ ] 实现子弹对象池（性能优化）
- [ ] 添加僵尸/敌人AI系统
- [ ] 主菜单和暂停菜单
- [ ] 完善UI（健康条、弹药显示等）

#### 中优先级
- [ ] 物品收集/背包系统
- [ ] 存档系统
- [ ] 建造系统
- [ ] 任务系统
- [ ] 调试UI面板

#### 低优先级
- [ ] 更多武器类型
- [ ] 更多敌人类型
- [ ] 天气系统
- [ ] 日夜循环
- [ ] 音效完善

## 操作说明

| 操作 | 按键 |
|------|------|
| 移动 | W/A/S/D |
| 跳跃 | 空格 |
| 瞄准 | 鼠标右键 |
| 射击 | 鼠标左键 |
| 换弹 | R |
| 暂停 | ESC |
| 相机旋转（鼠标模式） | 移动鼠标 |
| 相机旋转（键盘模式） | Q/E |
| 调整相机距离/高度 | 鼠标滚轮 |

## 自动加载单例

项目配置了以下自动加载单例：

| 名称 | 脚本 | 用途 |
|------|------|------|
| `GameConstants` | `res://scripts/constants.gd` | 游戏常量配置 |
| `GameManager` | `res://scripts/game_manager.gd` | 游戏状态管理 |
| `EventBus` | `res://scripts/event_bus.gd` | 事件总线 |

## 脚本说明

### 核心脚本

| 脚本 | 位置 | 功能 |
|------|------|------|
| `constants.gd` | `scripts/` | 游戏常量配置，包含所有硬编码数值和工具函数 |
| `event_bus.gd` | `scripts/` | 事件总线，用于解耦系统间通信 |
| `game_manager.gd` | `scripts/` | 游戏管理器，管理游戏状态和玩家 |

### 玩家脚本

| 脚本 | 位置 | 功能 |
|------|------|------|
| `player.gd` | `player/scripts/` | 玩家主脚本，处理移动、动画、射击等 |
| `player_input.gd` | `player/scripts/` | 玩家输入控制器，处理输入和相机 |
| `player_stats.gd` | `player/scripts/` | 玩家属性数据类，管理生命值、弹药等 |
| `player_stats_ui.gd` | `player/scripts/` | 玩家属性UI控制器 |
| `dynamic_crosshair.gd` | `player/scripts/` | 动态准星 |
| `circle_progress.gd` | `player/progress/` | 圆形进度条组件 |
| `bullet.gd` | `player/bullet/` | 子弹脚本 |

### 测试脚本

| 脚本 | 位置 | 功能 |
|------|------|------|
| `player_stats_test.gd` | `player/scripts/` | 玩家属性系统测试脚本 |
| `reload_test.gd` | `player/` | 换弹测试脚本 |

## 最近更新

### 2026-02-17
- 清理项目临时文件（场景临时文件）
- 整理项目结构
- 更新 README 文档，添加完整的功能说明和脚本列表

### 2026-02-16
- 修复 GDScript 静态函数调用错误（`STATIC_CALLED_ON_INSTANCE`）
- 修复参数名与内置函数冲突（`SHADOWED_GLOBAL_IDENTIFIER`）
- 使用 Godot 内置 `deg_to_rad()` 替代自定义函数
- 注释掉 Terrain3D 插件中已弃用的 API
- 更新常量配置系统，移除冗余的角度转换函数

## 注意事项

- Terrain3D 插件需要正确配置纹理资源以消除警告
- 部分功能处于开发阶段，可能存在未完善的地方
- 测试脚本（`player_stats_test.gd`、`reload_test.gd`）仅用于开发测试
